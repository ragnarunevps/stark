<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Cyber-Globe — Interactive System Layers Visualizer (Ethical Mode)</title>
  <style>
    :root{--bg:#0b0f19;--panel:#0f1724;--accent:#00d4ff;--muted:#9aa6b2}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#031025 0%,#071225 60%);font-family:Inter,system-ui,Segoe UI,Roboto,Arial;color:#dbe9f7}
    #app{height:100%;display:grid;grid-template-columns:360px 1fr;gap:12px;padding:12px}
    .panel{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:12px;padding:12px;box-shadow:0 6px 24px rgba(2,6,23,0.6)}
    #left{height:calc(100vh - 24px);overflow:auto}
    header{display:flex;align-items:center;gap:10px}
    header h1{font-size:18px;margin:0}
    .controls{margin-top:12px;display:flex;flex-direction:column;gap:8px}
    button,select,input{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px;border-radius:8px;color:inherit}
    #canvas-container{position:relative;border-radius:12px;overflow:hidden}
    canvas{display:block;width:100%;height:100%}
    .badge{font-size:12px;padding:6px;border-radius:8px;background:rgba(255,255,255,0.03);display:inline-block}
    .hint{font-size:13px;color:var(--muted)}
    #footer{position:absolute;right:18px;bottom:18px;background:rgba(0,0,0,0.4);padding:8px;border-radius:8px;font-size:13px}
    .node-list{margin-top:8px;display:flex;flex-direction:column;gap:6px}
    .node-item{display:flex;justify-content:space-between;gap:8px;padding:8px;border-radius:8px;background:linear-gradient(90deg,rgba(255,255,255,0.01),transparent)}
    pre small{color:var(--muted)}
    .k{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <div id="app">
    <aside id="left" class="panel">
      <header>
        <div style="width:46px;height:46px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#6c77ff);display:flex;align-items:center;justify-content:center;font-weight:700">CG</div>
        <div>
          <h1>Cyber-Globe</h1>
          <div class="k">Interactive system-layer globe — ethical training & defense</div>
        </div>
      </header>

      <div class="controls">
        <label class="k">Mode</label>
        <select id="mode">
          <option value="ethical">Ethical / Defensive (default)</option>
          <option value="training">Training (simulated)</option>
        </select>

        <label class="k">Layer visibility</label>
        <div style="display:flex;gap:6px;flex-wrap:wrap">
          <button data-layer="perimeter" class="layer-toggle badge">Perimeter</button>
          <button data-layer="network" class="layer-toggle badge">Network</button>
          <button data-layer="os" class="layer-toggle badge">OS</button>
          <button data-layer="apps" class="layer-toggle badge">Apps</button>
          <button data-layer="data" class="layer-toggle badge">Data</button>
        </div>

        <label class="k">Quick import sample</label>
        <button id="load-sample">Load example system</button>

        <label class="k">Search nodes</label>
        <input id="search" placeholder="hostname / service / tag" />

        <label class="k">Nodes (click to inspect)</label>
        <div class="node-list" id="node-list"></div>

        <label class="k">Export / Import</label>
        <div style="display:flex;gap:6px">
          <button id="export-json">Export JSON</button>
          <button id="import-json">Import JSON</button>
        </div>

        <div style="margin-top:8px">
          <div class="k">Shortcuts</div>
          <div class="hint">L — toggle layer menu • F — focus selected node • P — run pathfinder</div>
        </div>

        <hr style="opacity:0.06" />
        <div class="k">Notes</div>
        <div class="hint">This tool is intentionally non-actionable: it shows risk patterns & mitigation guidance only — not exploit instructions. Use for threat modeling, training, and red-team planning in controlled environments.</div>
      </div>
    </aside>

    <main class="panel" id="main">
      <div id="canvas-container" style="height:calc(100vh - 48px);position:relative">
        <div id="renderer-root"></div>
        <div id="footer">Ethical Mode ON</div>
      </div>
    </main>
  </div>

  <script src="https://unpkg.com/three@0.155.0/build/three.min.js"></script>
  <script src="https://unpkg.com/three@0.155.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://unpkg.com/three@0.155.0/examples/js/controls/DragControls.js"></script>
  <script src="https://unpkg.com/tween.js@18.6.4/dist/tween.umd.js"></script>
  <script>
    /* Cyber-Globe: single-file interactive visualizer
       Purpose: defensive training & threat modeling. This file purposely omits exploit details and focuses on visualization and mitigation recommendations. */

    // Scene boilerplate
    const container = document.getElementById('renderer-root');
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 2000);
    camera.position.set(0, 120, 400);
    const renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
    renderer.setSize(window.innerWidth - 420, window.innerHeight - 48);
    container.appendChild(renderer.domElement);

    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;

    // lighting
    const hemi = new THREE.HemisphereLight(0xffffff, 0x222244, 0.8);
    scene.add(hemi);
    const dir = new THREE.DirectionalLight(0xa0cfff, 0.6);
    dir.position.set(50, 200, 100);
    scene.add(dir);

    // globe layers: multiple concentric semi-transparent spheres
    const layers = {
      perimeter: createLayerSphere(220, 0x1f6feb, 0.02),
      network: createLayerSphere(170, 0x4dd0b2, 0.03),
      os: createLayerSphere(120, 0xffb86b, 0.03),
      apps: createLayerSphere(80, 0xff6b8a, 0.04),
      data: createLayerSphere(40, 0xd48bff, 0.08)
    };
    Object.values(layers).forEach(l=>scene.add(l.mesh));

    function createLayerSphere(radius, color, opacity){
      const geo = new THREE.SphereGeometry(radius, 64, 64);
      const mat = new THREE.MeshStandardMaterial({color, transparent:true, opacity, side:THREE.BackSide});
      const mesh = new THREE.Mesh(geo, mat);
      return {radius, color, mesh};
    }

    // node graph (abstract, non-actionable sample)
    let systemModel = {nodes:[],edges:[]};

    // utility to create node visual
    const nodeGroup = new THREE.Group();
    scene.add(nodeGroup);

    function addNode(id, label, layer, tags=[], severity=1){
      const r = 6 + Math.min(18, severity*3);
      const geo = new THREE.SphereGeometry(r, 24, 24);
      const mat = new THREE.MeshStandardMaterial({color:getColorForSeverity(severity),metalness:0.2,roughness:0.4});
      const mesh = new THREE.Mesh(geo, mat);
      const phi = Math.random()*Math.PI*2, theta = Math.random()*Math.PI;
      const L = layers[layer] ? layers[layer].radius - (Math.random()*6) : 60;
      mesh.position.set(Math.cos(phi)*L, Math.cos(theta)*L*0.45, Math.sin(phi)*L);
      mesh.userData = {id,label,layer,tags,severity};
      nodeGroup.add(mesh);
      systemModel.nodes.push({id,label,layer,tags,severity});
      return mesh;
    }

    function getColorForSeverity(s){
      if(s>=4) return 0xff4d4f; // high
      if(s>=3) return 0xffa94d; // med-high
      if(s>=2) return 0xffdf5d; // medium
      return 0x7be495; // low
    }

    // sample edges visual
    const edgeGroup = new THREE.Group(); scene.add(edgeGroup);
    function addEdge(aMesh,bMesh){
      const points=[aMesh.position.clone(), bMesh.position.clone()];
      const geo = new THREE.BufferGeometry().setFromPoints(points);
      const mat = new THREE.LineBasicMaterial({color:0xffffff,transparent:true,opacity:0.12});
      const line = new THREE.Line(geo, mat);
      edgeGroup.add(line);
      systemModel.edges.push({from:aMesh.userData.id,to:bMesh.userData.id});
    }

    // pick & inspect
    const ray = new THREE.Raycaster();
    const mouse = new THREE.Vector2();
    let selected = null;

    renderer.domElement.addEventListener('pointerdown', (ev)=>{
      const rect = renderer.domElement.getBoundingClientRect();
      mouse.x = ((ev.clientX-rect.left)/rect.width)*2-1;
      mouse.y = -((ev.clientY-rect.top)/rect.height)*2+1;
      ray.setFromCamera(mouse,camera);
      const intersects = ray.intersectObjects(nodeGroup.children);
      if(intersects.length){
        const m = intersects[0].object;
        inspectNode(m);
      }
    });

    function inspectNode(mesh){
      selected = mesh;
      updateNodeListUI();
      focusOn(mesh);
      showInspectorPopup(mesh.userData);
    }

    function focusOn(mesh){
      const target = mesh.position.clone();
      new TWEEN.Tween(camera.position).to({x:target.x*1.6,y:target.y*1.2,z:target.z*1.6},600).easing(TWEEN.Easing.Cubic.Out).start();
      new TWEEN.Tween(controls.target).to({x:target.x,y:target.y,z:target.z},600).easing(TWEEN.Easing.Cubic.Out).start();
    }

    function showInspectorPopup(data){
      // small non-actionable card at top-right
      const cardId = 'inspect-card';
      let c = document.getElementById(cardId);
      if(c) c.remove();
      c = document.createElement('div'); c.id=cardId;
      Object.assign(c.style,{position:'absolute',right:'18px',top:'18px',padding:'12px',background:'rgba(2,6,23,0.9)',borderRadius:'10px',width:'320px',zIndex:10,boxShadow:'0 10px 30px rgba(0,0,0,0.6)'});
      c.innerHTML = `<div style="font-weight:700;margin-bottom:6px">${escapeHtml(data.label)}</div>
                     <div class='k'>Layer: ${data.layer}</div>
                     <div style='margin-top:8px' class='k'>Tags: ${data.tags.join(', ') || '—'}</div>
                     <div style='margin-top:8px;color:#bcd'>Risk level: ${data.severity}/5</div>
                     <div style='margin-top:10px;font-size:13px'>Suggested controls (defensive):</div>
                     <ul style='margin:6px 0 0 18px;color:#9ec6d9;font-size:13px'>
                       <li>Configuration hardening & patch cadence</li>
                       <li>Network segmentation & least privilege</li>
                       <li>Strong authentication & logging</li>
                     </ul>
                     <div style='display:flex;gap:8px;margin-top:10px'>
                       <button id='btn-run-path'>Run abstract pathfinder</button>
                       <button id='btn-close'>Close</button>
                     </div>`;
      document.getElementById('canvas-container').appendChild(c);

      document.getElementById('btn-close').onclick = ()=>c.remove();
      document.getElementById('btn-run-path').onclick = ()=>{
        c.remove();
        runPathfinderFrom(data.id);
      }
    }

    function escapeHtml(s){return (''+s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}

    // node list UI
    const nodeListEl = document.getElementById('node-list');
    function updateNodeListUI(filter){
      nodeListEl.innerHTML='';
      systemModel.nodes.filter(n=>!filter||n.label.toLowerCase().includes(filter.toLowerCase())).forEach(n=>{
        const el = document.createElement('div'); el.className='node-item';
        el.innerHTML = `<div><strong>${n.label}</strong><div class='k'>${n.layer} • ${n.tags.join(', ')}</div></div><div style='display:flex;flex-direction:column;align-items:flex-end'><div class='k'>R:${n.severity}</div><button data-id='${n.id}'>Focus</button></div>`;
        nodeListEl.appendChild(el);
        el.querySelector('button').onclick = ()=>{
          const m = nodeGroup.children.find(x=>x.userData.id===n.id);
          if(m) inspectNode(m);
        };
      });
    }

    // pathfinder: abstract graph search producing non-actionable path suggestions + defensive checklist
    function runPathfinderFrom(startId){
      // build adjacency
      const adj = {};
      systemModel.nodes.forEach(n=>adj[n.id]=[]);
      systemModel.edges.forEach(e=>{adj[e.from].push(e.to);adj[e.to].push(e.from)});

      // BFS limited depth, returning a few highest aggregated-risk paths
      const maxDepth = 5; const results=[];
      function dfs(curr,visited,path,score){
        if(path.length>1) results.push({path:[...path],score});
        if(path.length>=maxDepth) return;
        adj[curr].forEach(nb=>{
          if(visited.has(nb)) return;
          visited.add(nb);
          const node = systemModel.nodes.find(x=>x.id===nb);
          dfs(nb,visited,path.concat(nb),score + (node?node.severity:1));
          visited.delete(nb);
        });
      }
      const start = startId;
      dfs(start,new Set([start]),[start],0);
      results.sort((a,b)=>b.score-a.score);
      const top = results.slice(0,6);

      // show results (non-actionable): list path node labels + defensive checklist
      const card = document.createElement('div'); Object.assign(card.style,{position:'absolute',left:'18px',top:'18px',padding:'12px',background:'rgba(2,6,23,0.92)',borderRadius:'10px',width:'360px',zIndex:10,boxShadow:'0 10px 30px rgba(0,0,0,0.6)'});
      card.innerHTML = `<div style='font-weight:700'>Abstract attack-path candidates</div><div style='font-size:13px;margin-top:6px;color:#9ec6d9'>Top paths (simulated & non-actionable)</div>`;
      top.forEach(t=>{
        const labels = t.path.map(id=>systemModel.nodes.find(n=>n.id===id)?.label||id);
        const div = document.createElement('div'); div.style.marginTop='8px'; div.innerHTML = `<div style='font-weight:600'>${labels.join(' → ')}</div><div class='k'>aggregated risk: ${t.score.toFixed(1)}</div>`;
        card.appendChild(div);
      });
      const mitigation = document.createElement('div'); mitigation.style.marginTop='10px'; mitigation.innerHTML = `<div style='font-weight:700'>Suggested defensive actions (generic)</div><ul style='margin:6px 0 0 18px' class='k'><li>Patch & verify secure configuration</li><li>Micro-segmentation and least-privilege</li><li>Centralized logging & anomaly detection</li><li>Multi-factor authentication & key rotation</li><li>Periodic red-team exercises and blameless postmortems</li></ul>`;
      card.appendChild(mitigation);
      const close = document.createElement('div'); close.style.marginTop='8px'; close.innerHTML = `<div style='display:flex;gap:8px'><button id='close-path'>Close</button><button id='focus-path'>Highlight path</button></div>`;
      card.appendChild(close);
      document.getElementById('canvas-container').appendChild(card);
      document.getElementById('close-path').onclick = ()=>card.remove();
      document.getElementById('focus-path').onclick = ()=>{
        highlightPath(top[0]);
        card.remove();
      };
    }

    function highlightPath(pathObj){
      if(!pathObj) return;
      const idset = new Set(pathObj.path||[]);
      nodeGroup.children.forEach(n=>{
        if(idset.has(n.userData.id)) n.material.emissive = new THREE.Color(0x00d4ff);
        else n.material.emissive = new THREE.Color(0x000000);
      });
    }

    // sample system loader
    document.getElementById('load-sample').onclick = ()=>{
      // clear
      nodeGroup.clear(); edgeGroup.clear(); systemModel={nodes:[],edges:[]};
      // create sample nodes (abstract)
      const ids = [];
      ids.push(addNode('fw-01','Firewall-Perimeter','perimeter',['firewall','edge'],2));
      ids.push(addNode('lb-01','LoadBalancer','network',['lb','ingress'],2));
      ids.push(addNode('web-01','Web-Server','apps',['http','nginx'],3));
      ids.push(addNode('app-01','App-Server','apps',['java','api'],3));
      ids.push(addNode('db-01','Database','data',['sql'],4));
      ids.push(addNode('adm-01','Admin-Host','os',['ssh','admin'],5));
      // edges (abstract)
      addEdge(nodeGroup.children[0],nodeGroup.children[1]);
      addEdge(nodeGroup.children[1],nodeGroup.children[2]);
      addEdge(nodeGroup.children[2],nodeGroup.children[3]);
      addEdge(nodeGroup.children[3],nodeGroup.children[4]);
      addEdge(nodeGroup.children[3],nodeGroup.children[5]);
      updateNodeListUI();
    };

    // export/import
    document.getElementById('export-json').onclick = ()=>{
      const data = JSON.stringify(systemModel,null,2);
      const blob = new Blob([data],{type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='system-model.json'; a.click(); URL.revokeObjectURL(url);
    };
    document.getElementById('import-json').onclick = ()=>{
      const inp = document.createElement('input'); inp.type='file'; inp.accept='application/json'; inp.onchange = e=>{
        const f = e.target.files[0]; const reader=new FileReader(); reader.onload=ev=>{
          try{ const parsed = JSON.parse(ev.target.result); loadModel(parsed);}catch(err){alert('Invalid JSON')}
        }; reader.readAsText(f);
      }; inp.click();
    };

    function loadModel(m){
      nodeGroup.clear(); edgeGroup.clear(); systemModel={nodes:[],edges:[]};
      (m.nodes||[]).forEach(n=>{
        const mesh = addNode(n.id,n.label,n.layer,n.tags||[],n.severity||1);
      });
      // naive edge draw by id->mesh mapping
      (m.edges||[]).forEach(e=>{
        const a = nodeGroup.children.find(x=>x.userData.id===e.from);
        const b = nodeGroup.children.find(x=>x.userData.id===e.to);
        if(a && b) addEdge(a,b);
      });
      updateNodeListUI();
    }

    // layer toggles
    document.querySelectorAll('.layer-toggle').forEach(btn=>btn.onclick = (ev)=>{
      const layer = ev.target.getAttribute('data-layer');
      const mesh = layers[layer].mesh; mesh.visible = !mesh.visible;
      ev.target.style.opacity = mesh.visible?1:0.45;
    });

    // search
    document.getElementById('search').addEventListener('input',(e)=>updateNodeListUI(e.target.value));

    // responsive
    window.addEventListener('resize',()=>{
      renderer.setSize(window.innerWidth - 420, window.innerHeight - 48);
      camera.aspect = (window.innerWidth - 420)/(window.innerHeight - 48);
      camera.updateProjectionMatrix();
    });

    // animation loop
    function animate(t){
      requestAnimationFrame(animate);
      nodeGroup.rotation.y += 0.0006;
      TWEEN.update(t);
      controls.update();
      renderer.render(scene,camera);
    }
    animate();

    // initial hint: small footer behavior
    const footer = document.getElementById('footer');
    document.getElementById('mode').addEventListener('change',(e)=>{
      if(e.target.value==='ethical') footer.textContent='Ethical Mode ON';
      else footer.textContent='Training Mode (simulated)';
    });

    // keyboard shortcuts
    window.addEventListener('keydown',(e)=>{
      if(e.key.toLowerCase()==='l') document.querySelectorAll('.layer-toggle')[0].click();
      if(e.key.toLowerCase()==='p' && selected) runPathfinderFrom(selected.userData.id);
      if(e.key.toLowerCase()==='f' && selected) focusOn(selected);
    });

    // tiny helper: seed random for reproducible layout (optional)
  </script>
</body>
</html>

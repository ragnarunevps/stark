<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stark Globe: Ultimate Ethical Hacking System Navigator</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #000; /* PURE BLACK */
            font-family: 'Courier New', monospace;
            color: #00aa00;
        }
        #info-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 350px;
            background: rgba(0, 0, 0, 0.95); /* PURE BLACK */
            border: 1px solid #00aa00;
            padding: 15px;
            border-radius: 5px;
            display: none;
            z-index: 100;
            max-height: 500px;
            overflow-y: auto;
            box-shadow: 0 0 20px rgba(0, 170, 0, 0.2);
        }
        #legend, #controls, #scan-results {
            background: rgba(0, 0, 0, 0.95); /* PURE BLACK */
        }
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #00aa00;
            font-size: 18px;
            z-index: 200;
            text-align: center;
        }
        button {
            background: #000;
            color: #00aa00;
            border: 1px solid #00aa00;
        }
        button:hover {
            background: #00aa00;
            color: #000;
        }
        #search-input {
            background: #000;
            color: #00aa00;
            border: 1px solid #00aa00;
        }
    </style>
</head>
<body>
    <div id="loading">Initializing Stark Globe... <br><span style="font-size:14px;">Secure View Loading...</span></div>
    <div id="info-panel">
        <h3 id="node-title">Node Intel</h3>
        <ul id="node-details"></ul>
        <div id="layer-vulns">
            <h4>Layer Loopholes</h4>
            <ul id="layer-loopholes"></ul>
        </div>
    </div>

    <div id="legend">
        <strong>Orbital Layers:</strong><br>
        <span style="color:#cc0000">● Perimeter (DMZ)</span><br>
        <span style="color:#ccaa00">● Infrastructure</span><br>
        <span style="color:#00aa00">● Core Systems</span><br>
        <strong>Status:</strong> <span id="vuln-count">0</span> active exploits
    </div>

    <div id="controls">
        <input type="text" id="search-input" placeholder="Search Node..." onkeyup="searchNodes(event)">
        <br>
        <button onclick="resetView()">Reset Orbit</button>
        <button onclick="togglePaths()">Toggle Vectors</button>
        <button onclick="explodeView()">Explode Layers</button>
        <button onclick="simulateAttack()">Simulate Breach</button>
        <button onclick="scanForVulns()">Deep Scan</button>
    </div>

    <div id="scan-results">
        <h3>Scan Complete</h3>
        <div id="results-list"></div>
        <button onclick="closeScan()">Acknowledge</button>
    </div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.181.2/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.181.2/examples/jsm/"
        }
    }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

        window.scene = new THREE.Scene();
        window.scene.fog = new THREE.Fog(0x000000, 15, 80);

        window.camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        window.camera.position.set(0, 0, 25);

        window.renderer = new THREE.WebGLRenderer({ antialias: true });
        window.renderer.setSize(window.innerWidth, window.innerHeight);
        window.renderer.setClearColor(0x000000); /* PURE BLACK */
        document.body.appendChild(window.renderer.domElement);

        window.controls = new OrbitControls(window.camera, window.renderer.domElement);

        const renderScene = new RenderPass(window.scene, window.camera);
        window.composer = new EffectComposer(window.renderer);
        window.composer.addPass(renderScene);
        window.composer.addPass(new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 2, 0.4, 0.1));

        const nodeData = [
            { name: 'Edge Firewall', layer: 'perimeter', radius: 12, phi: 0, theta: 0, vulns: ['Rule Bypass'], nextSteps: ['Nmap'], difficulty: 3 },
            { name: 'WAF', layer: 'perimeter', radius: 12, phi: Math.PI/5, theta: Math.PI/2, vulns: ['False Negatives'], nextSteps: ['Bypass'], difficulty: 4 },
            { name: 'Reverse Proxy', layer: 'perimeter', radius: 12, phi: Math.PI/3, theta: Math.PI, vulns: ['Path Traversal'], nextSteps: ['DirBust'], difficulty: 2 },
            { name: 'CDN Edge', layer: 'perimeter', radius: 12, phi: Math.PI/2, theta: 4.2, vulns: ['Cache Poisoning'], nextSteps: ['Spoof'], difficulty: 5 },
            { name: 'Web Cluster', layer: 'infra', radius: 7, phi: 0, theta: Math.PI/4, vulns: ['XSS'], nextSteps: ['BeEF'], difficulty: 2 },
            { name: 'API Gateway', layer: 'infra', radius: 7, phi: Math.PI/4, theta: 2.3, vulns: ['BOLA'], nextSteps: ['JWT Forge'], difficulty: 4 },
            { name: 'App Servers', layer: 'infra', radius: 7, phi: Math.PI/2, theta: Math.PI, vulns: ['Prototype Pollution'], nextSteps: ['NoSQL'], difficulty: 3 },
            { name: 'Message Queue', layer: 'infra', radius: 7, phi: 2.5, theta: 3.5, vulns: ['Queue Poison'], nextSteps: ['Enum'], difficulty: 5 },
            { name: 'Cache Layer', layer: 'infra', radius: 7, phi: 3.14, theta: 5, vulns: ['DDoS'], nextSteps: ['Attack'], difficulty: 1 },
            { name: 'DB', layer: 'core', radius: 4, phi: 1.3, theta: 1.6, vulns: ['SQLi'], nextSteps: ['Dump'], difficulty: 4 }
        ];

        const layerColors = { perimeter: 0xcc0000, infra: 0xccaa00, core: 0x00aa00 };
        const layers = { perimeter: new THREE.Group(), infra: new THREE.Group(), core: new THREE.Group() };
        Object.values(layers).forEach(l => scene.add(l));

        window.nodes = [];
        nodeData.forEach((d, i) => {
            const x = d.radius * Math.sin(d.phi) * Math.cos(d.theta);
            const y = d.radius * Math.sin(d.phi) * Math.sin(d.theta);
            const z = d.radius * Math.cos(d.phi);

            const mesh = new THREE.Mesh(
                new THREE.IcosahedronGeometry(0.25, 1),
                new THREE.MeshStandardMaterial({
                    color: layerColors[d.layer],
                    emissive: layerColors[d.layer],
                    emissiveIntensity: 0.4
                })
            );
            mesh.position.set(x, y, z);
            mesh.userData = d;
            layers[d.layer].add(mesh);
            nodes.push(mesh);
        });

        /* ⭐ NEW REAL STARFIELD — SMOOTH PARTICLES */
        function createStars() {
            const starGeometry = new THREE.BufferGeometry();
            const starCount = 6000;
            const starPos = new Float32Array(starCount * 3);

            for (let i = 0; i < starCount * 3; i++) {
                starPos[i] = (Math.random() - 0.5) * 400;
            }
            starGeometry.setAttribute('position', new THREE.BufferAttribute(starPos, 3));
            const starMaterial = new THREE.PointsMaterial({
                size: 0.7,
                color: 0xffffff,
                transparent: true,
                opacity: 0.9
            });
            const stars = new THREE.Points(starGeometry, starMaterial);
            scene.add(stars);
        }
        createStars(); /* replaces floating cubes */

        window.addEventListener('resize', () => {
            window.camera.aspect = window.innerWidth / window.innerHeight;
            window.camera.updateProjectionMatrix();
            window.renderer.setSize(window.innerWidth, window.innerHeight);
        });

        function animate() {
            requestAnimationFrame(animate);
            Object.values(layers).forEach(l => l.rotation.y += 0.002);
            window.composer.render();
        }

        animate();
        document.getElementById('loading').style.display = 'none';

        /* Dummy stubs so controls still work */
        function resetView() { controls.reset(); }
        function togglePaths() {}
        function explodeView() {}
        function simulateAttack() {}
        function scanForVulns() {}
        function closeScan(){ document.getElementById('scan-results').style.display = 'none'; }
        function searchNodes(){}
    </script>
</body>
</html>
